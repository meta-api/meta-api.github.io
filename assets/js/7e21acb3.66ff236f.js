"use strict";(self.webpackChunkmeta_api_docs=self.webpackChunkmeta_api_docs||[]).push([[19],{3905:function(e,t,r){r.d(t,{Zo:function(){return u},kt:function(){return m}});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var c=n.createContext({}),l=function(e){var t=n.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},u=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=l(r),m=o,f=d["".concat(c,".").concat(m)]||d[m]||p[m]||i;return r?n.createElement(f,a(a({ref:t},u),{},{components:r})):n.createElement(f,a({ref:t},u))}));function m(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=r.length,a=new Array(i);a[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,a[1]=s;for(var l=2;l<i;l++)a[l]=r[l];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},4841:function(e,t,r){r.r(t),r.d(t,{assets:function(){return u},contentTitle:function(){return c},default:function(){return m},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return p}});var n=r(7462),o=r(3366),i=(r(7294),r(3905)),a=["components"],s={id:"fix-429-api-error",title:'How to fix "429 Too Many Requests" on an API?'},c=void 0,l={unversionedId:"common-errors/fix-429-api-error",id:"common-errors/fix-429-api-error",title:'How to fix "429 Too Many Requests" on an API?',description:"What's a 429 Too Many Requests' error",source:"@site/docs/common-errors/3-fix-429-error.md",sourceDirName:"common-errors",slug:"/common-errors/fix-429-api-error",permalink:"/docs/common-errors/fix-429-api-error",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"fix-429-api-error",title:'How to fix "429 Too Many Requests" on an API?'},sidebar:"mySidebar",previous:{title:'How to fix "401 Unauthorized" when accessing a Spell?',permalink:"/docs/common-errors/fix-401-spell-error"},next:{title:'How to fix "400 Missing servers on OAS" when adding a new API?',permalink:"/docs/common-errors/fix-missing-servers-openapi"}},u={},p=[{value:"What&#39;s a 429 Too Many Requests&#39; error",id:"whats-a-429-too-many-requests-error",level:2},{value:"How to fix this error",id:"how-to-fix-this-error",level:2}],d={toc:p};function m(e){var t=e.components,s=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,n.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"whats-a-429-too-many-requests-error"},"What's a 429 Too Many Requests' error"),(0,i.kt)("p",null,'An HTTP Error 429 "Too Many Requests" mean that you have sent too many request in a short period of time to the same API.'),(0,i.kt)("p",null,'Most APIs have "rate limiting" to prevent users to request too much their API and cause some deny of service.'),(0,i.kt)("p",null,"That's happened to your code if you request many APIs inside a loop or in parallel."),(0,i.kt)("h2",{id:"how-to-fix-this-error"},"How to fix this error"),(0,i.kt)("p",null,"The first thing is to look for the rate limit inside the vendor's API documentation. If you don't find this information, you can start with a value of ",(0,i.kt)("strong",{parentName:"p"},"30 request per minute")," and adapt it to a higher or lower value."),(0,i.kt)("p",null,"Then, you can use the ",(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/bottleneck"},"bottleneck")," NPM package to limit the number send to a connector."),(0,i.kt)("p",null,"Here is an example with Airtable, limited to ",(0,i.kt)("strong",{parentName:"p"},"5 requests per second"),":"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Airtable code",src:r(8588).Z,width:"1920",height:"1077"})),(0,i.kt)("p",null,"This code use the Airtable list connector to retrieve a list of entries and then, for each entry, I send a new request to get more detailed information."),(0,i.kt)("p",null,"If you have for example 200 entries inside my Airtable, this code will generate 201 requests in a short amount of time, breaking the Airtable's rate limit."),(0,i.kt)("p",null,"So the first to do is adding the ",(0,i.kt)("inlineCode",{parentName:"p"},"bottleneck")," dependency inside my Spell. You can refer to ",(0,i.kt)("a",{parentName:"p",href:"/docs/spell/using-dependencies/import-package"},"this guide")," on adding a dependency:"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Add bottleneck package",src:r(7213).Z,width:"1919",height:"1079"})),(0,i.kt)("p",null,"Then, according to bottleneck's documentation, I need to define and configure a new ",(0,i.kt)("inlineCode",{parentName:"p"},"limiter"),": "),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Bottleneck limiter",src:r(3560).Z,width:"1918",height:"1078"})),(0,i.kt)("p",null,"This limiter has been configured to wait at least 200ms between each request, limiting them to 5 requests per seconds max."),(0,i.kt)("p",null,'Next, I need to "surround" each of our connector with bottleneck\'s ',(0,i.kt)("inlineCode",{parentName:"p"},"schedule"),' function to "wait" if a request is trigger in less than 200ms.'),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Add bottleneck schedule",src:r(1902).Z,width:"1918",height:"1075"})),(0,i.kt)("p",null,"Now, our two connector will share the same ",(0,i.kt)("strong",{parentName:"p"},"limiter")," and the ",(0,i.kt)("inlineCode",{parentName:"p"},"schedule")," function will ensure to never overpass the 5 requests per second limit."),(0,i.kt)("p",null,"Bottleneck package have many additional settings you can find on their ",(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/bottleneck"},"documentation")))}m.isMDXComponent=!0},7213:function(e,t,r){t.Z=r.p+"assets/images/add-bottleneck-00283fa7cb307a425cb488e02ba6b6c8.jpg"},3560:function(e,t,r){t.Z=r.p+"assets/images/add-limiter-8e08e1cd2fca6443b9d1157f8356bdd5.jpg"},1902:function(e,t,r){t.Z=r.p+"assets/images/add-schedule-735543b03ae759c6abdf629e54f06c39.jpg"},8588:function(e,t,r){t.Z=r.p+"assets/images/airtable-code-d49c59abc9c5e04d58d0af30c60573e9.jpg"}}]);