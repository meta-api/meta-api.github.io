"use strict";(self.webpackChunkmeta_api_docs=self.webpackChunkmeta_api_docs||[]).push([[5656],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=a,h=u["".concat(s,".").concat(m)]||u[m]||c[m]||r;return n?o.createElement(h,i(i({ref:t},d),{},{components:n})):o.createElement(h,i({ref:t},d))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3471:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return c}});var o=n(7462),a=n(3366),r=(n(7294),n(3905)),i=["components"],l={id:"example-webhook-typeform",title:"Using Webhook with Typeform and Google Spreadsheet"},s=void 0,p={unversionedId:"examples/example-webhook-typeform",id:"examples/example-webhook-typeform",title:"Using Webhook with Typeform and Google Spreadsheet",description:"You have textual explanations and a video for each step",source:"@site/docs/examples/1-webhook-typeform.md",sourceDirName:"examples",slug:"/examples/example-webhook-typeform",permalink:"/docs/examples/example-webhook-typeform",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"example-webhook-typeform",title:"Using Webhook with Typeform and Google Spreadsheet"},sidebar:"mySidebar",previous:{title:'How to fix "400 Missing servers on OAS" when adding a new API?',permalink:"/docs/common-errors/fix-missing-servers-openapi"},next:{title:"Manually request an API inside your code with axios",permalink:"/docs/examples/manual-request"}},d={},c=[{value:"1. A blank Spell to start and analyze incoming data",id:"1-a-blank-spell-to-start-and-analyze-incoming-data",level:2},{value:"Video demo",id:"video-demo",level:3},{value:"2. Set up the webhook on Typeform and test it",id:"2-set-up-the-webhook-on-typeform-and-test-it",level:2},{value:"Video demo",id:"video-demo-1",level:3},{value:"3. Process Typeform data from webhook",id:"3-process-typeform-data-from-webhook",level:2},{value:"Video demo",id:"video-demo-2",level:3},{value:"4. Using Google Spreadsheet as a connector",id:"4-using-google-spreadsheet-as-a-connector",level:2},{value:"Video demo",id:"video-demo-3",level:3},{value:"5. Push on production and live test",id:"5-push-on-production-and-live-test",level:2},{value:"Video demo",id:"video-demo-4",level:3},{value:"Bonus",id:"bonus",level:2},{value:"The code",id:"the-code",level:3}],u={toc:c};function m(e){var t=e.components,l=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},u,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"You have textual explanations and a video for each step")),(0,r.kt)("h2",{id:"1-a-blank-spell-to-start-and-analyze-incoming-data"},"1. A blank Spell to start and analyze incoming data"),(0,r.kt)("p",null,"First, you'll need to create a new blank Spell. Each Spell has a unique URL and this URL will be the destination of a webhook."),(0,r.kt)("p",null,"Open the ",(0,r.kt)("strong",{parentName:"p"},"Payload")," and clear it (leave an empty JSON object: ",(0,r.kt)("inlineCode",{parentName:"p"},"{}"),")."),(0,r.kt)("p",null,"We'll now log the content of the ",(0,r.kt)("inlineCode",{parentName:"p"},"params")," variable to know what is coming from the webhook."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"params")," variable is always set inside your Spell."),(0,r.kt)("p",{parentName:"admonition"},"This variable contains anything sent to your Spell, using query parameters inside the URL.\nYou can also call your Spell URL with the ",(0,r.kt)("inlineCode",{parentName:"p"},"POST")," method and the ",(0,r.kt)("inlineCode",{parentName:"p"},"params")," variable will contain the body of your request."),(0,r.kt)("p",{parentName:"admonition"},"For example, if you add these parameters ",(0,r.kt)("inlineCode",{parentName:"p"},"&firstName=Harry&lastName=Potter")," to a Spell URL (ex: ",(0,r.kt)("inlineCode",{parentName:"p"},"https://api.meta-api.io/api/spells/626c75a3123471b901ec7f71/runSync?dev=true&apikey=xxx&firstName=Harry&lastName=Potter"),"), your ",(0,r.kt)("inlineCode",{parentName:"p"},"params")," variable will contain:"),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre"},'{\n    firstName: "Harry",\n    lastname: "Potter"\n}\n'))),(0,r.kt)("p",null,"Finally, go to the ",(0,r.kt)("strong",{parentName:"p"},"Versions")," tab, click on ",(0,r.kt)("strong",{parentName:"p"},"dev")," environment and copy the URL with the default API key using the dedicated button."),(0,r.kt)("h3",{id:"video-demo"},"Video demo"),(0,r.kt)("video",{src:n(8289).Z,style:{width:"100%"},controls:!0}),(0,r.kt)("h2",{id:"2-set-up-the-webhook-on-typeform-and-test-it"},"2. Set up the webhook on Typeform and test it"),(0,r.kt)("p",null,"We use Typeform for the purpose of this video."),(0,r.kt)("p",null,"Go on your Typeform, then on the ",(0,r.kt)("strong",{parentName:"p"},"Connect")," menu. Click on the ",(0,r.kt)("strong",{parentName:"p"},"Webhook")," tab and create a new webhook."),(0,r.kt)("p",null,"You can paste your Spell URL here."),(0,r.kt)("p",null,"Set your webhook delivery to ",(0,r.kt)("strong",{parentName:"p"},"On")," and go to the ",(0,r.kt)("strong",{parentName:"p"},"View deliveries")," menu."),(0,r.kt)("p",null,"Click on ",(0,r.kt)("strong",{parentName:"p"},"Send test request")," to send a request on your Spell."),(0,r.kt)("p",null,"On the next menu, you can see the payload send to your Spell and the Response should be ",(0,r.kt)("strong",{parentName:"p"},"200"),". If not, check your Spell URL and retry."),(0,r.kt)("p",null,"Go back and on your Spell and click on the ",(0,r.kt)("strong",{parentName:"p"},"Console")," menu: you should see inside a log entry the content of Typeform's payload."),(0,r.kt)("h3",{id:"video-demo-1"},"Video demo"),(0,r.kt)("video",{src:n(4592).Z,style:{width:"100%"},controls:!0}),(0,r.kt)("h2",{id:"3-process-typeform-data-from-webhook"},"3. Process Typeform data from webhook"),(0,r.kt)("p",null,"Let's process the data in order to extract all responses each time a webhook is sent."),(0,r.kt)("p",null,"To make this process easier, you can copy and paste the payload from Typeform inside your own payload. That will let you test your code each time you need it."),(0,r.kt)("p",null,"You can now work the way you want to process your data (you have to use here your JS skills)."),(0,r.kt)("h3",{id:"video-demo-2"},"Video demo"),(0,r.kt)("video",{src:n(2893).Z,style:{width:"100%"},controls:!0}),(0,r.kt)("h2",{id:"4-using-google-spreadsheet-as-a-connector"},"4. Using Google Spreadsheet as a connector"),(0,r.kt)("p",null,"We have now the answers we want. We'll use Google Spreadsheet connector to append a new line each time we receive a new answer from Typeform."),(0,r.kt)("p",null,"First, we'll create a new Google Spreadsheet and set the headers for our table."),(0,r.kt)("p",null,"Use the left menu to ",(0,r.kt)("strong",{parentName:"p"},"Add a new connector"),", choose ",(0,r.kt)("em",{parentName:"p"},"Google Spreadsheet")," and the ",(0,r.kt)("strong",{parentName:"p"},"append")," endpoint."),(0,r.kt)("p",null,"We can use the ",(0,r.kt)("strong",{parentName:"p"},"One-click authentication")," to connect our Google account to Meta API."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"You can also configure your own OAuth 2 account manually if you want to control all settings and if you later want to release a Google OAuth window with your own logo and application name for your end-users.")),(0,r.kt)("p",null,"We will configure the ",(0,r.kt)("inlineCode",{parentName:"p"},"spreadsheetId"),", the ",(0,r.kt)("inlineCode",{parentName:"p"},"range")," and the ",(0,r.kt)("inlineCode",{parentName:"p"},"valueInputOption"),"."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The A1 notation for Google Spreadsheet is detailed in their ",(0,r.kt)("a",{parentName:"p",href:"https://developers.google.com/sheets/api/guides/concepts"},"documentation"))),(0,r.kt)("p",null,"Inside our code, we'll configure the ",(0,r.kt)("inlineCode",{parentName:"p"},"values")," variables inside our connector's body, which is getting an array of array."),(0,r.kt)("h3",{id:"video-demo-3"},"Video demo"),(0,r.kt)("video",{src:n(5706).Z,style:{width:"100%"},controls:!0}),(0,r.kt)("h2",{id:"5-push-on-production-and-live-test"},"5. Push on production and live test"),(0,r.kt)("p",null,"Since our tests are working fine, time to deploy our Spell and test it in production!"),(0,r.kt)("p",null,"Go on ",(0,r.kt)("strong",{parentName:"p"},"Versions")," menu, click on ",(0,r.kt)("strong",{parentName:"p"},"Create a new version")," and promote it to production."),(0,r.kt)("p",null,"Copy the new URL of your Spell."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The difference between your Spell in development or in production is done by the URL parameter ",(0,r.kt)("inlineCode",{parentName:"p"},"&dev=true")," inside the URL."),(0,r.kt)("p",{parentName:"admonition"},"You can easily use this parameter if you want to switch between environments.")),(0,r.kt)("p",null,"Then, update your existing webhook or add a new webhook on the Typeform interface."),(0,r.kt)("p",null,"You can clean your Google Spreadsheet from your test values."),(0,r.kt)("p",null,"Open the URL of your Typeform and answer it."),(0,r.kt)("p",null,"Then, go on your Google Spreadsheet, and you'll see a new line."),(0,r.kt)("p",null,"Typeform is now connected to Google Spreadsheet through your own Spell!"),(0,r.kt)("p",null,"If you go back to your Spell's detail page, you'll see a new line in your logs interface with all information you choose to log inside."),(0,r.kt)("h3",{id:"video-demo-4"},"Video demo"),(0,r.kt)("video",{src:n(2914).Z,style:{width:"100%"},controls:!0}),(0,r.kt)("h2",{id:"bonus"},"Bonus"),(0,r.kt)("h3",{id:"the-code"},"The code"),(0,r.kt)("p",null,"Here is the full code used inside our demo. You can easily replace the Google Spreadsheet connector part with a new connector from your interface."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'const { form_response } = params;\n\nconsole.log(params);\n\nconst finalAnswer = {};\n\nfor (const answer of form_response.answers) {\n  const field = form_response.definition.fields.find(\n    (f) => f.id === answer.field.id\n  );\n\n  if (!field) {\n    console.error("Unable to find the target field");\n    continue;\n  }\n\n  let response;\n\n  switch (answer.type) {\n    case "choice":\n      response = answer.choice.label;\n      break;\n    case "text":\n      response = answer.text;\n      break;\n    default:\n      console.error("Unable to process this kind of answer");\n      break;\n  }\n\n  finalAnswer[field.title] = response;\n}\n\nconsole.log({ finalAnswer });\n\n//#region Start of Google Spreadsheet connector\nconst googleSpreadsheetResult: Datapostvspreadsheetsspreadsheetidvaluesrangeappend =\n  await connectorService.config("626d1955b77971e210ec8a1a", {\n    body: {\n      majorDimension: "DIMENSION_UNSPECIFIED",\n      values: [\n        [\n          form_response.submitted_at,\n          finalAnswer["Question 1"],\n          finalAnswer["Question 2"],\n        ],\n      ],\n    },\n  });\nconsole.info({ "Google Spreadsheet": googleSpreadsheetResult });\n//#endregion End of Google Spreadsheet connector\n')))}m.isMDXComponent=!0},5706:function(e,t,n){t.Z=n.p+"assets/medias/webhook-connect-gsheet-84c6234391df25dec15a641458d0dc85.mp4"},8289:function(e,t,n){t.Z=n.p+"assets/medias/webhook-set-params-4b77d7e8d4215789dd2dc243d1e754d7.mp4"},2914:function(e,t,n){t.Z=n.p+"assets/medias/webhook-test-prod-c54783a389dd4e738c7e8cb85d69808b.mp4"},2893:function(e,t,n){t.Z=n.p+"assets/medias/webhook-testing-payload-2e109921c588091aa8b01e4258ecb4f0.mp4"},4592:function(e,t,n){t.Z=n.p+"assets/medias/webhook-typeform-setup-test-b7af2d387c1621a3bfc31c7582bde59a.mp4"}}]);