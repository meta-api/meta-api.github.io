"use strict";(self.webpackChunkmeta_api_docs=self.webpackChunkmeta_api_docs||[]).push([[2927],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return h}});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=i.createContext({}),p=function(e){var t=i.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},s=function(e){var t=p(e.components);return i.createElement(u.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,u=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=p(n),h=a,f=d["".concat(u,".").concat(h)]||d[h]||c[h]||o;return n?i.createElement(f,r(r({ref:t},s),{},{components:n})):i.createElement(f,r({ref:t},s))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=d;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var p=2;p<o;p++)r[p]=n[p];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1344:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return u},default:function(){return h},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return c}});var i=n(7462),a=n(3366),o=(n(7294),n(3905)),r=["components"],l={id:"using-meta-api-auth-external-profile-oauth",title:"Using Meta-API to authenticate end user with OAuth2"},u=void 0,p={unversionedId:"api-authentication/dynamic-auth/using-meta-api-auth-external-profile-oauth",id:"api-authentication/dynamic-auth/using-meta-api-auth-external-profile-oauth",title:"Using Meta-API to authenticate end user with OAuth2",description:"Video tutorial",source:"@site/docs/api-authentication/dynamic-auth/2-using-meta-api-auth-external-oauth2.md",sourceDirName:"api-authentication/dynamic-auth",slug:"/api-authentication/dynamic-auth/using-meta-api-auth-external-profile-oauth",permalink:"/docs/api-authentication/dynamic-auth/using-meta-api-auth-external-profile-oauth",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"using-meta-api-auth-external-profile-oauth",title:"Using Meta-API to authenticate end user with OAuth2"},sidebar:"mySidebar",previous:{title:"Link a variable to an authentication",permalink:"/docs/api-authentication/dynamic-auth/link-variable-auth"},next:{title:"Authenticate your GitHub account",permalink:"/docs/api-authentication/example-auth/github-oauth-app"}},s={},c=[{value:"Video tutorial",id:"video-tutorial",level:3},{value:"Authentication profiles",id:"authentication-profiles",level:3},{value:"Identifier management",id:"identifier-management",level:3},{value:"Creating an OAuth login button",id:"creating-an-oauth-login-button",level:3},{value:"Using an authentication profile in a Spell",id:"using-an-authentication-profile-in-a-spell",level:3},{value:"Endpoint to manage profiles",id:"endpoint-to-manage-profiles",level:3},{value:"Retrieve profiles",id:"retrieve-profiles",level:4},{value:"Delete profiles",id:"delete-profiles",level:4}],d={toc:c};function h(e){var t=e.components,l=(0,a.Z)(e,r);return(0,o.kt)("wrapper",(0,i.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h3",{id:"video-tutorial"},"Video tutorial"),(0,o.kt)("div",{style:{margin:"auto"}},(0,o.kt)("div",{style:{position:"relative",width:"100%",paddingBottom:"56.25%"}},(0,o.kt)("iframe",{title:"Quick Start Video",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:0},src:"https://www.youtube.com/embed/x6AOO3uOGgg",allowFullScreen:!0,allow:"autoplay; encrypted-media; picture-in-picture"}))),(0,o.kt)("h3",{id:"authentication-profiles"},"Authentication profiles"),(0,o.kt)("p",null,"OAuth's authentication accounts are capable of handling multiple profiles."),(0,o.kt)("p",null,"Once an authorization has been given, the account will appear in the list of profiles on the account configuration page"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"./assets/oauth-public/Untitled.png",src:n(2572).Z,width:"2150",height:"1478"})),(0,o.kt)("p",null,"We can see that this OAuth configuration contains an active profile"),(0,o.kt)("p",null,"If you have authorized several accounts, you will see the different accounts appear in the list (after refreshing the page):"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"./assets/oauth-public/Untitled1.png",src:n(3506).Z,width:"2068",height:"986"})),(0,o.kt)("p",null,"It is possible to delete these profiles or to change the default account."),(0,o.kt)("p",null,"This default account will be used if no authentication profile is specified when calling the connector (details below)."),(0,o.kt)("p",null,"\u26a0\ufe0f If a profile is deleted, it will be necessary to redo the authentication process for that profile."),(0,o.kt)("h3",{id:"identifier-management"},"Identifier management"),(0,o.kt)("p",null,"Connector credentials are managed in three different ways:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"If the authentication API supports OpenID, this identifier will be retrieved and associated with the account. In case of manual renewal of the account, the profile will not be duplicated."),(0,o.kt)("li",{parentName:"ul"},"If you have specified a custom ID (via the OAuth login button), it will be used. This method is very convenient if you want to use a custom ID like an email address or an ID from your own database."),(0,o.kt)("li",{parentName:"ul"},"Otherwise, a UUID type identifier will be automatically assigned (ex: ",(0,o.kt)("inlineCode",{parentName:"li"},"b5639e9a-c606-4f0d-8947-96a5360a1cd4"),"). \u26a0\ufe0f If this profile is reauthorized, it will be at risk of being duplicated.")),(0,o.kt)("h3",{id:"creating-an-oauth-login-button"},"Creating an OAuth login button"),(0,o.kt)("p",null,"At the bottom of the OAuth configuration window, a drop-down panel provides instructions on how to create your own OAuth login button for your site:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"./assets/oauth-public/Untitled2.png",src:n(9408).Z,width:"1986",height:"1176"})),(0,o.kt)("p",null,"The code displayed will be automatically customized according to your account."),(0,o.kt)("p",null,"You can use the example code or create your own button."),(0,o.kt)("p",null,"The classic way is to open in a new window the URL provided."),(0,o.kt)("p",null,"\u26a0\ufe0f If you are using an embedded view or popup on your site or an iframe, this can cause security issues with some APIs."),(0,o.kt)("p",null,"\u26a0\ufe0f Remember to customize or remove the ",(0,o.kt)("inlineCode",{parentName:"p"},"userId")," parameter in the URL."),(0,o.kt)("h3",{id:"using-an-authentication-profile-in-a-spell"},"Using an authentication profile in a Spell"),(0,o.kt)("p",null,"When you want to use a particular profile in a connector in your Spell, simply specify the account to use via the account configuration interface."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"OAuth Profile Interface",src:n(5008).Z,width:"1128",height:"826"})),(0,o.kt)("p",null,"If no profile is specified when calling the connector, then the profile defined by default in the OAuth configuration will be used."),(0,o.kt)("p",null,"It is also possible to call a connector programmatically by using the variable system in the connector code."),(0,o.kt)("p",null,"To do this, declare a variable in the code that will carry the OAuth profile ID."),(0,o.kt)("p",null,"Then, click on the button to select your variable, the OAuth profile will be called dynamically."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"OAuth Profile Variable",src:n(5608).Z,width:"1920",height:"955"})),(0,o.kt)("h3",{id:"endpoint-to-manage-profiles"},"Endpoint to manage profiles"),(0,o.kt)("h4",{id:"retrieve-profiles"},"Retrieve profiles"),(0,o.kt)("p",null,"It is possible to retrieve the list of saved profiles via the following endpoint:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"GET https://api.meta-api.io/api/clients/:CLIENT_ID/securities/:AUTH_ACCOUNT_ID/profiles\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"CLIENT_ID"),": Your client identifier. You can retrieve it by going on this page : ",(0,o.kt)("a",{parentName:"p",href:"https://dashboard.meta-api.io/mySubscription"},"My Subscription details")," and take your client ID inside the URL"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Client ID URL",src:n(6279).Z,width:"824",height:"335"})),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"AUTH_ACCOUNT_ID"),": identifier of the authentication account (present on the list of authentication accounts)"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Auth ID",src:n(137).Z,width:"1919",height:"926"})),(0,o.kt)("p",null,"Authentication can be done either via API key (put ",(0,o.kt)("inlineCode",{parentName:"p"},"apikey")," with the API key in the header, recommended method), or via the JWT key (put in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Authorization")," header). All active API keys will be valid."),(0,o.kt)("p",null,"This will give the list of profiles with some metadata:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "id": "https://login.salesforce.com/id/00D2X000003DmUAK/0052X0008NasQAC",\n    "created_at": "2020-06-16T10:35:30.605Z",\n    "updated_at": "2020-06-16T10:35:30.605Z",\n    "scope": "openid api",\n    "expiration": "2020-06-16T11:35:30.601Z",\n    "hasRefreshToken": true,\n    "isDefault": false\n  },\n  {\n    "id": "https://login.salesforce.com/id/00D2X000003DmUAK/0052X0008NasQAC",\n    "created_at": "2020-06-16T10:38:06.220Z",\n    "updated_at": "2020-06-16T10:38:06.220Z",\n    "scope": "openid api",\n    "expiration": "2020-06-16T11:35:30.601Z",\n    "hasRefreshToken": true,\n    "isDefault": false\n  },\n  {\n    "id": "test@test.com",\n    "created_at": "2020-06-16T10:38:47.154Z",\n    "updated_at": "2020-06-16T10:39:16.949Z",\n    "scope": "openid api",\n    "expiration": "2020-06-16T11:35:30.601Z",\n    "hasRefreshToken": true,\n    "isDefault": true\n  }\n]\n')),(0,o.kt)("p",null,"It is also possible to add a query param ",(0,o.kt)("inlineCode",{parentName:"p"},"id")," to filter only one profile."),(0,o.kt)("p",null,"Example of a query:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'GET https://api.meta-api.io/api/clients/:CLIENT_ID/securities/:AUTH_ACCOUNT_ID/profiles?id="test@test.com"\n')),(0,o.kt)("p",null,"Response:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "id": "test@test.com",\n    "created_at": "2020-06-16T10:38:47.154Z",\n    "updated_at": "2020-06-16T10:39:16.949Z",\n    "scope": "openid api",\n    "expiration": "2020-06-16T11:35:30.601Z",\n    "hasRefreshToken": false,\n    "isDefault": true\n  }\n]\n')),(0,o.kt)("h4",{id:"delete-profiles"},"Delete profiles"),(0,o.kt)("p",null,"It is possible to delete profiles via the following endpoint:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},"DELETE https://api.meta-api.io/api/clients/:CLIENT_ID/securities/:AUTH_ACCOUNT_ID/profiles/:PROFILE_ID\n")),(0,o.kt)("p",null,"Authentication is done, like the ",(0,o.kt)("inlineCode",{parentName:"p"},"GET")," endpoint, via the ",(0,o.kt)("inlineCode",{parentName:"p"},"apikey")," key in the header."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"A connector is available on Meta API for this, you can find it ",(0,o.kt)("a",{parentName:"p",href:"https://dashboard.meta-api.io/connectors/Meta-API-626a8e0cd6cbe017b9e1a380"},"here"),".")))}h.isMDXComponent=!0},137:function(e,t,n){t.Z=n.p+"assets/images/auth_id-c09f27c80961a92bffd616582c5f1064.jpg"},6279:function(e,t,n){t.Z=n.p+"assets/images/client_id_url-8c3f94a599acb7fe6ed7d9d54ce1ec39.jpg"},2572:function(e,t,n){t.Z=n.p+"assets/images/configOauth-accf06ef4b596547d4440e44f0d15214.png"},9408:function(e,t,n){t.Z=n.p+"assets/images/integration_code-3448f8bc3b690e7b8f39553a47e17d72.png"},5008:function(e,t,n){t.Z=n.p+"assets/images/oauth-profile-gui-2b36ffecc507f9e1c0f96dbe146c5fa7.png"},5608:function(e,t,n){t.Z=n.p+"assets/images/oauth-profile-var-e2e9f0bf246c76f933bd37a516f18d01.png"},3506:function(e,t,n){t.Z=n.p+"assets/images/profileOauth-77b0c98651d2b8b55cf0bffe883bcc0c.png"}}]);