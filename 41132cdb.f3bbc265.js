(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{156:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/Untitled-d969cdd7a2ead53cc04a24a760953f32.png"},157:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/Untitled1-e2156c041d059312d52e12942d7c2694.png"},158:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/Untitled2-071b064ac696a1f03cb83da0a3315c9e.png"},159:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/oauth-profile-gui-7340feb55ef9cd0077f638a67ac912ab.png"},160:function(e,t,n){"use strict";n.r(t),t.default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAkCAYAAADl9UilAAAABHNCSVQICAgIfAhkiAAAArlJREFUWEftmK2v6kAQxQ8NkBI+siSXpLjKlZXIK5FIJBLJn/Dkk0gkshKJRCIr66giNUCBQErCx5vdFrh5efdC+5pQwQhS2snur2fOTJPNXCgOhwOWyyV838crQ1EUVKtVVCoVZM/nM1zXlTdqtRqy2exL2I7HI7bbLRaLhdw/s16vL+JCUKYhVqsVNpsNlN1uh1KplAYmyVAulyGqqIg/orZpiauV0kP0lzJvsKhWeSv2VuxbBXwPXgJftoS/Pz7sUR9DC2CNDnotHeq3b/Dzg4TBXFh2IJeqqrGhBHKyXelYcCQXg25oP0vy4GlMMB8OlezXbxOWd9/BtW3Iv4zD0ChnLHKGmH7JecBzexwDzINtko+mLnzPwnjihIt5VMaAQNU5NHo2kjk2Rv0hJm60jogIRpubAzK3B7ENM1roksFlEIDjiguVykimZw10O5/QhPt9G+PBAOOgzkH+g98IYB6mwz7MsHaa6Lp2g9wUhE9lDLh0cD3oRVVvotdtgUs4F5Ph83ARwMjQ/N7+nkMK3apDfrIdqSI0HoCEwC7lXauoMh26lPBxRACjPaVKhlTJd6cYknfIRhQOrJBS4zxUMWiQwShoCFX7ROeq3mOu6OOCGW3yDsGJFydfTaakFKkSjC8GzsPikvknFpmf0kRJu90mwgo/gQXEGrCMt9HrMJhThhaZ3xuZQRlpTPDr+CLztzuezGmSF6NOtVhg4pWFCh1dXLnUbeGY4AbkrTDuOV9uPnkZyWP/XJPKaYdjglNzJBWxFbsBMIPK6ZP5ARpfiUVmPp9f6vV6YgsmsdBsNovelUls/Mwa/++xZ3aJkfMGiypaehXL5XLyECMtIY6jRCiFQgF0FJUWLnlGls/noRSLRZxOJ4hzqSvtKyjF3tezsY+PD2TEUacAEaT7/f6lZRW2YozJU80/yfoN3AdbLFIAAAAASUVORK5CYII="},161:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/oauth-profile-var-dadf399c3200b379c5a429b5340b65e3.png"},74:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return o})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return c}));var i=n(3),a=n(7),r=(n(0),n(90)),l={id:"oauth-public",title:"OAuth Public (FR only)"},o={unversionedId:"guides/oauth-public",id:"guides/oauth-public",isDocsHomePage:!1,title:"OAuth Public (FR only)",description:"OAuth Public",source:"@site/docs/guides/oauth-public.md",slug:"/guides/oauth-public",permalink:"/docs/guides/oauth-public",version:"current",sidebar:"mainSidebar",previous:{title:"Connectors' authentication",permalink:"/docs/guides/connectors-authentication"},next:{title:"Generate a file from a Spell",permalink:"/docs/guides/file-output-spell"}},s=[{value:"OAuth Public",id:"oauth-public",children:[{value:"Profils d&#39;authentification",id:"profils-dauthentification",children:[]},{value:"La gestion des identifiants",id:"la-gestion-des-identifiants",children:[]},{value:"Cr\xe9er un bouton de connexion OAuth",id:"cr\xe9er-un-bouton-de-connexion-oauth",children:[]},{value:"Utilisation d&#39;un profil d&#39;authentification dans un Spell",id:"utilisation-dun-profil-dauthentification-dans-un-spell",children:[]},{value:"Endpoint pour g\xe9rer les profiles",id:"endpoint-pour-g\xe9rer-les-profiles",children:[]}]}],u={rightToc:s};function c(e){var t=e.components,l=Object(a.a)(e,["components"]);return Object(r.b)("wrapper",Object(i.a)({},u,l,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"oauth-public"},"OAuth Public"),Object(r.b)("h3",{id:"profils-dauthentification"},"Profils d'authentification"),Object(r.b)("p",null,"Les comptes d'authentification de type OAuth sont capables de g\xe9rer plusieurs profils."),Object(r.b)("p",null,"Une fois qu'une autorisation a \xe9t\xe9 donn\xe9e, le compte appara\xeetra dans la liste des profils sur la configuration du compte :"),Object(r.b)("p",null,Object(r.b)("img",{alt:"./assets/oauth-public/Untitled.png",src:n(156).default})),Object(r.b)("p",null,"On voit ici que cette configuration OAuth contient un profil actif"),Object(r.b)("p",null,"Si on a autoris\xe9 plusieurs comptes, on verra les diff\xe9rents comptes appara\xeetre dans la liste (apr\xe8s rafra\xeechissement de la page) :"),Object(r.b)("p",null,Object(r.b)("img",{alt:"./assets/oauth-public/Untitled1.png",src:n(157).default})),Object(r.b)("p",null,"Il est possible de supprimer les profils ou de changer le compte par d\xe9faut."),Object(r.b)("p",null,"Ce compte par d\xe9faut sera utilis\xe9 si aucun profil d'authentification n'est pr\xe9cis\xe9 lors de l'appel du connecteur (d\xe9tails plus bas)."),Object(r.b)("p",null,"\u26a0\ufe0f En cas de suppression d'un profil, il sera n\xe9cessaire de refaire le processus d'authentification de ce profil."),Object(r.b)("h3",{id:"la-gestion-des-identifiants"},"La gestion des identifiants"),Object(r.b)("p",null,"Les identifiants des connecteurs sont g\xe9r\xe9s de trois mani\xe8res diff\xe9rentes :"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Si l'API d'authentification supporte l'OpenID, cet identifiant sera r\xe9cup\xe9r\xe9 et associ\xe9 au compte. En cas de renouvellement manuel du compte, le profil ne sera donc pas dupliqu\xe9 et sera conserv\xe9"),Object(r.b)("li",{parentName:"ul"},"Si on a pr\xe9cis\xe9 un identifiant personnalis\xe9 (via le bouton de connexion OAuth), celui-ci sera utilis\xe9. Cette m\xe9thode est tr\xe8s pratique si vous souhaitez utiliser un identifiant personnalis\xe9 comme une adresse mail ou un identifiant de votre propre base de donn\xe9es."),Object(r.b)("li",{parentName:"ul"},"Sinon, un identifiant du type UUID sera automatiquement attribu\xe9 (ex : ",Object(r.b)("inlineCode",{parentName:"li"},"b5639e9a-c606-4f0d-8947-96a5360a1cd4"),"). \u26a0\ufe0f En cas d'autorisation \xe0 nouveau de ce profil, celui-ci risquera d'\xeatre dupliqu\xe9.")),Object(r.b)("h3",{id:"cr\xe9er-un-bouton-de-connexion-oauth"},"Cr\xe9er un bouton de connexion OAuth"),Object(r.b)("p",null,"En bas de la fen\xeatre de configuration OAuth, un panneau d\xe9roulant permet de d'avoir les instructions pour cr\xe9er son propre bouton de connexion OAuth \xe0 int\xe9grer sur son site : "),Object(r.b)("p",null,Object(r.b)("img",{alt:"./assets/oauth-public/Untitled2.png",src:n(158).default})),Object(r.b)("p",null,"Le code affich\xe9 sera automatiquement personnalis\xe9 selon votre compte."),Object(r.b)("p",null,"Vous pouvez utiliser le code d'exemple ou cr\xe9er votre propre bouton."),Object(r.b)("p",null,"Le fonctionnement classique est d'ouvrir dans une nouvelle fen\xeatre l'URL qui est fournie."),Object(r.b)("p",null,"\u26a0\ufe0f Si vous utilisez une vue ou popup int\xe9gr\xe9e sur votre site ou une iframe, cela peut poser des probl\xe8mes de s\xe9curit\xe9 avec certaines API."),Object(r.b)("p",null,"\u26a0\ufe0f N'oubliez pas de personnaliser ou de supprimer le param\xe8tre ",Object(r.b)("inlineCode",{parentName:"p"},"userId")," dans l'URL."),Object(r.b)("h3",{id:"utilisation-dun-profil-dauthentification-dans-un-spell"},"Utilisation d'un profil d'authentification dans un Spell"),Object(r.b)("p",null,"Quand vous voulez utiliser un profil en particulier dans un connecteur de votre Spell, pr\xe9cisez simplement le compte \xe0 utiliser via l'interface de configuration du compte."),Object(r.b)("p",null,Object(r.b)("img",{alt:"OAuth Profile Interface",src:n(159).default})),Object(r.b)("p",null,"Si aucun profil n'est pr\xe9cis\xe9 lors de l'appel du connecteur, alors le profil d\xe9fini par d\xe9faut dans la configuration OAuth sera utilis\xe9."),Object(r.b)("p",null,"Il est aussi possible d'appeler un connecteur de mani\xe8re programmatique en utilisant le syst\xe8me de variable dans le code des connecteurs."),Object(r.b)("p",null,"Pour cela, d\xe9clarez dans le code une variable qui portera l'identifiant du profil Oauth."),Object(r.b)("p",null,"Ensuite, cliquez sur le bouton ",Object(r.b)("img",{alt:"Add var icon",src:n(160).default})," pour s\xe9lectionner votre variable."),Object(r.b)("p",null,"Ainsi, le profile OAuth sera appel\xe9 dynamiquement."),Object(r.b)("p",null,Object(r.b)("img",{alt:"OAuth Profile Variable",src:n(161).default})),Object(r.b)("h3",{id:"endpoint-pour-g\xe9rer-les-profiles"},"Endpoint pour g\xe9rer les profiles"),Object(r.b)("h4",{id:"r\xe9cup\xe9rer-les-profils"},"R\xe9cup\xe9rer les profils"),Object(r.b)("p",null,"Il est possible de r\xe9cup\xe9rer la liste des profils enregistr\xe9s via le endpoint suivant :"),Object(r.b)("pre",null,Object(r.b)("code",Object(i.a)({parentName:"pre"},{className:"language-json"}),"GET https://api.meta-api.io/api/clients/:CLIENT_ID/securities/:AUTH_ACCOUNT_ID/profiles\n")),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"CLIENT_ID")," : son identifiant client"),Object(r.b)("p",null,Object(r.b)("inlineCode",{parentName:"p"},"AUTH_ACCOUNT_ID")," : identifiant du compte d'authentification (pr\xe9sent sur la liste des comptes d'authentification)"),Object(r.b)("p",null,"L'authentification peut se faire soit via cl\xe9 API (mettre ",Object(r.b)("inlineCode",{parentName:"p"},"apikey")," avec la cl\xe9 API dans le header, m\xe9thode conseill\xe9e), soit via la cl\xe9 JWT (\xe0 mettre dans le header ",Object(r.b)("inlineCode",{parentName:"p"},"Authorization"),"). Toutes les cl\xe9s API actives seront valides."),Object(r.b)("p",null,"Cela va donner la liste des profils avec quelques m\xe9ta donn\xe9es : "),Object(r.b)("pre",null,Object(r.b)("code",Object(i.a)({parentName:"pre"},{className:"language-json"}),'[\n    {\n        "id": "https://login.salesforce.com/id/00D2X000003DmUAK/0052X0008NasQAC",\n        "created_at": "2020-06-16T10:35:30.605Z",\n        "updated_at": "2020-06-16T10:35:30.605Z",\n        "scope": "openid api",\n        "expiration": "2020-06-16T11:35:30.601Z",\n        "hasRefreshToken": true,\n        "isDefault": false\n    },\n    {\n        "id": "https://login.salesforce.com/id/00D2X000003DmUAK/0052X0008NasQAC",\n        "created_at": "2020-06-16T10:38:06.220Z",\n        "updated_at": "2020-06-16T10:38:06.220Z",\n        "scope": "openid api",\n        "expiration": "2020-06-16T11:35:30.601Z",\n        "hasRefreshToken": true,\n        "isDefault": false\n    },\n    {\n        "id": "test@test.com",\n        "created_at": "2020-06-16T10:38:47.154Z",\n        "updated_at": "2020-06-16T10:39:16.949Z",\n        "scope": "openid api",\n        "expiration": "2020-06-16T11:35:30.601Z",\n        "hasRefreshToken": true,\n        "isDefault": true\n    }\n]\n')),Object(r.b)("p",null,"Il est aussi possible de rajouter un query param ",Object(r.b)("inlineCode",{parentName:"p"},"id")," pour ne filtrer qu'un seul profile."),Object(r.b)("p",null,"Exemple de requ\xeate : "),Object(r.b)("pre",null,Object(r.b)("code",Object(i.a)({parentName:"pre"},{className:"language-json"}),'GET https://api.meta-api.io/api/clients/:CLIENT_ID/securities/:AUTH_ACCOUNT_ID/profiles?id="test@test.com"\n')),Object(r.b)("p",null,"R\xe9ponse de r\xe9ponse :"),Object(r.b)("pre",null,Object(r.b)("code",Object(i.a)({parentName:"pre"},{className:"language-json"}),'[\n    {\n        "id": "test@test.com",\n        "created_at": "2020-06-16T10:38:47.154Z",\n        "updated_at": "2020-06-16T10:39:16.949Z",\n        "scope": "openid api",\n        "expiration": "2020-06-16T11:35:30.601Z",\n        "hasRefreshToken": false,\n        "isDefault": true\n    }\n]\n')),Object(r.b)("h4",{id:"supprimer-les-profils"},"Supprimer les profils"),Object(r.b)("p",null,"Il est possible de supprimer les profils via le endpoint suivant :"),Object(r.b)("pre",null,Object(r.b)("code",Object(i.a)({parentName:"pre"},{className:"language-json"}),"DELETE https://api.meta-api.io/api/clients/:CLIENT_ID/securities/:AUTH_ACCOUNT_ID/profiles/:PROFILE_ID\n")),Object(r.b)("p",null,"L'authentification se fait, comme le ",Object(r.b)("inlineCode",{parentName:"p"},"GET"),", via la cl\xe9 ",Object(r.b)("inlineCode",{parentName:"p"},"apikey")," dans le header. "))}c.isMDXComponent=!0},90:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return f}));var i=n(0),a=n.n(i);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=a.a.createContext({}),c=function(e){var t=a.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.a.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},b=a.a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(n),b=i,f=p["".concat(l,".").concat(b)]||p[b]||d[b]||r;return n?a.a.createElement(f,o(o({ref:t},u),{},{components:n})):a.a.createElement(f,o({ref:t},u))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,l=new Array(r);l[0]=b;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var u=2;u<r;u++)l[u]=n[u];return a.a.createElement.apply(null,l)}return a.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);